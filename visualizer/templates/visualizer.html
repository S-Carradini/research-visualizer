{% extends "base.html" %}
{% load static %}

<!-- Header block -->
{% block header %}
<link rel="stylesheet" type="text/css" href="{% static 'css/v_network_graph_style.css' %}" />
{% endblock %}

<!-- Content block -->
{% block content %}
<section v-cloak id="visualizer">

    <!----------->
    <!-- Setup -->
    <!----------->

    <div v-if="loadingPage">
        Loading...
    </div>
    <div v-else-if="selectingSearch">
        <div>
        Enter a search query to generate new results or select from the list of existing search results.
        </div>

        <!-- Search bar -->
        <div>
            <div>New Search:</div>
            <input v-model=query type="text"></input>
            <a @click.prevent="initiateSearch" class="btn">Search</a>
        </div>

        <div v-if="searches && searches.length">
            <div>Existing Search Results:</div>
            <div v-for="search in searches">
                <a @click.prevent="selectSearch(search)">${ search.query }, ${ search.categories }, ${ search.finished_at }</a>
            </div>
        </div>

    </div>

    <!-------------------->
    <!-- Search results -->
    <!-------------------->

    <div v-else-if="loadingSearchResults">
        Loading...
        <!-- TODO: Provide status for real-time search on the categories being searched, one by one -->
    </div>
    <div v-else>

        <!-- Breadcrumbs -->
        <div v-if="classification">
            <a @click="exitSearch">search</a> > <a @click="exitCategory">${ search.query }</a> > <a @click="exitClassification">${ category }</a> > ${ classification }
        </div>
        <div v-else-if="category">
            <a @click="exitSearch">search</a> > <a @click="exitCategory">${ search.query }</a> > ${ category }
        </div>
        <div v-else>
            <a @click="exitSearch">search</a> > ${ search.query }
        </div>

        <!-- Errors -->
        <div v-if="errors.length > 0">
            <div v-for="error in errors">
                <div>${ error }</div>
            </div>
        </div>

        <!-- Third-level search results: entries for classification -->
        <div v-if="classification">
            <div v-if="loadingClassificationEntries">
                Loading...
            </div>
            <div v-else>
                <div v-for="entry in classificationEntries">
                    <div>${ entry }</div>
                </div>
            </div>
        </div>

        <template v-else>

            <!-- First-level search results: all categories -->
            <network-graph v-if="!isEmpty(spokeNodes)" :spoke-nodes="spokeNodes" :event-handlers="eventHandlers"></network-graph>
        </template>

    </div>
</section>
{% endblock %}

<!-- Page-Specific JS, uncompressed -->
{% block bottomjs_uncompressed %}
<script>
    // Translate django variables to JS variables
</script>
{% endblock %}

<!-- Page-Specific JS, compressed -->
{% block bottomjs_compressed %}
<script defer type="module" src="{% static 'js/visualizer.js' %}"></script>
{% endblock %}